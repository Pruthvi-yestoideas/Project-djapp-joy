{% extends 'v1/base.html' %} 

{% block navbar_right %}
<div class="app-navbar-item ms-1 ms-md-3">
        <button type="submit" id="submit_btn1" class="btn btn-primary">
            <span class="indicator-label">Continue <i class="ki-duotone ki-right"></i></span>
            <span class="indicator-progress">Please wait...
            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
        </button>
</div>
{% endblock %}

{% block navbar_left %}

{% endblock %}

{% block content%}
<style>
  .swal2-modal {
    width: 850px !important;
  }
  input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
    }
        /* Firefox */
    input[type=number] {
    -moz-appearance: textfield;
    }
</style>

<div id="kt_app_content" class="app-content flex-column-fluid">
	<!--begin::Content container-->
	<div id="kt_app_content_container" class="app-container container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-12 col-md-12 col-sm-12 col-12 mb-5">
                <form method="POST" id="mainForm" enctype="multipart/form-data" class="single-label-form-body">
                    {% csrf_token %}
                        <div class="alert alert-primary alert-dismissible fade show" role="alert">
                            <strong >Please note: International shipping is currently not available.</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>

                        
                        <div class="card ">
                            <div class="card-header">
                                <h5 class="card-title">
                                    Ship From 
                                    <span class="ms-1" data-bs-toggle="tooltip" aria-label="The Return/From Address" data-bs-original-title="The Return/From Address">
                                        <i class="ki-outline ki-information-5 text-gray-500 fs-6"></i>
                                    </span>
                                </h5>
                                <div class="d-flex flex-stack">
                                    <!--begin::Label-->
                                    <div class="me-5">
                                        <!--begin::Label-->
                                        <label class="fs-5 fw-semibold">An Existing Address</label>
                                        <!--end::Label-->
                                    </div>
                                    <!--end::Label-->
                                    <!--begin::Switch-->
                                    <label class="form-check form-switch form-check-custom form-check-solid">
                                        <!--begin::Label-->
                                        <span class="form-check-label fw-semibold text-muted" style="margin-right: .5rem;">No</span>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <input id="custom_address" class="form-check-input" type="checkbox" checked />
                                        <!--end::Input-->
                                        <!--begin::Label-->
                                        <span class="form-check-label fw-semibold text-muted">Yes</span>
                                        <!--end::Label-->
                                    </label>
                                    <!--end::Switch-->
                                </div>
                                
                            </div>
                            
                            <div class="card-body">
                                <select class="form-select form-select-solid text-dark address_option mt-5" title="Single Select">
                                    <option selected=""
                                        data-kt-rich-content-subcontent="<b>{{ default_address.0 }} {{ default_address.1 }} </b><span class='badge badge-exclusive badge-light-primary fw-semibold fs-8 px-2 py-1 ms-1'>Default</span> <br>{{ default_address.2 }} {{ default_address.3 }} {{ default_address.4 }} {{ default_address.5 }} {{ default_address.6 }} <img src='/static/assets1/media/flags/united-states.png' width='18px'>"
                                        data-firstname="{{ default_address.0 }}" data-lastname="{{ default_address.1 }}"
                                        data-address-one="{{ default_address.2 }}" data-address-two="{{ default_address.3 }}"
                                        data-city="{{ default_address.4 }}" data-state="{{ default_address.5 }}"
                                        data-zip="{{ default_address.6 }}" data-phone="{{ default_address.7 }}" value="0"
                                    ></option>
                                    {% for key, address in addresses.items %}
                                        <option 
                                            data-kt-rich-content-subcontent="<b>{{ address.0 }} {{ address.1 }}</b><br>{{ address.2 }} {{ address.3 }} {{ address.4 }} {{ address.5 }} {{ address.6 }} <img src='/static/assets1/media/flags/united-states.png' width='18px'></span>"
                                            data-firstname="{{ address.0 }}" data-lastname="{{ address.1 }}"
                                            data-address-one="{{ address.2 }}" data-address-two="{{ address.3 }}"
                                            data-city="{{ address.4 }}" data-state="{{ address.5 }}"
                                            data-zip="{{ address.6 }}" data-phone="{{ address.7 }}" value="0"
                                        ></option>
                                    {% endfor %}
                                </select>
                                <div class="col-6 save_as_default mt-3" id="edit_address">
                                    <div class="form-check form-check-custom form-check-solid">
                                        <input class="form-check-input" name="save_as_default" id="edit_address_check" type="checkbox" value="1" id="flexCheckDefault"/>
                                        <label class="form-check-label" for="flexCheckDefault">
                                            Edit selected address
                                        </label>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="card-body" id="custom_address_fields" style="display:none">
                                <div class="row">
                                    <div class="col-md-6 pr-md-1">
                                        <label>First Name*</label>
                                        <div class="form-group">
                                            <input type="text" name="firstname_2" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="First Name" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 pr-md-1">
                                        <label>Last Name</label>
                                        <div class="form-group">
                                            <input type="text" name="lastname_2" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Last Name">
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-6 pr-md-1">
                                        <label>Address Line 1*</label>
                                        <div class="form-group">
                                            <input type="text" name="address_2" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Address 1" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 pr-md-1">
                                        <label>Address Line 2</label>
                                        <div class="form-group">
                                            <input type="text" name="address2_2" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Address 2">
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-3 pr-md-1">
                                        <label>City*</label>
                                        <div class="form-group">
                                            <input type="text" name="city_2" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="City" required>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <div class="form-group">
                                            <label>State*</label>
                                            <select class="form-select form-select-solid" name="abbreviation_2" data-control="select2" data-placeholder="Select an Option">
                                                <option selected>Select an Option</option>
                                                <option value="AL">Alabama</option>
                                                <option value="AK">Alaska</option>
                                                <option value="AZ">Arizona</option>
                                                <option value="AR">Arkansas</option>
                                                <option value="CA">California</option>
                                                <option value="CO">Colorado</option>
                                                <option value="CT">Connecticut</option>
                                                <option value="DE">Delaware</option>
                                                <option value="FL">Florida</option>
                                                <option value="GA">Georgia</option>
                                                <option value="HI">Hawaii</option>
                                                <option value="ID">Idaho</option>
                                                <option value="IL">Illinois</option>
                                                <option value="IN">Indiana</option>
                                                <option value="IA">Iowa</option>
                                                <option value="KS">Kansas</option>
                                                <option value="KY">Kentucky</option>
                                                <option value="LA">Louisiana</option>
                                                <option value="ME">Maine</option>
                                                <option value="MD">Maryland</option>
                                                <option value="MA">Massachusetts</option>
                                                <option value="MI">Michigan</option>
                                                <option value="MN">Minnesota</option>
                                                <option value="MS">Mississippi</option>
                                                <option value="MO">Missouri</option>
                                                <option value="MT">Montana</option>
                                                <option value="NE">Nebraska</option>
                                                <option value="NV">Nevada</option>
                                                <option value="NH">New Hampshire</option>
                                                <option value="NJ">New Jersey</option>
                                                <option value="NM">New Mexico</option>
                                                <option value="NY">New York</option>
                                                <option value="NC">North Carolina</option>
                                                <option value="ND">North Dakota</option>
                                                <option value="OH">Ohio</option>
                                                <option value="OK">Oklahoma</option>
                                                <option value="OR">Oregon</option>
                                                <option value="PA">Pennsylvania</option>
                                                <option value="RI">Rhode Island</option>
                                                <option value="SC">South Carolina</option>
                                                <option value="SD">South Dakota</option>
                                                <option value="TN">Tennessee</option>
                                                <option value="TX">Texas</option>
                                                <option value="UT">Utah</option>
                                                <option value="VT">Vermont</option>
                                                <option value="VA">Virginia</option>
                                                <option value="WA">Washington</option>
                                                <option value="WV">West Virginia</option>
                                                <option value="WI">Wisconsin</option>
                                                <option value="WY">Wyoming</option>
                                                <option value="DC">District of Columbia</option>
                                                <option value="MH">Marshall Islands</option>
                                                <option value="PR">PUERTO RICO</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <label>Zip Code*</label>
                                        <div class="form-group">
                                            <input type="text" name="zip_code_2" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Postal Code" required>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <label>Contact No.</label>
                                        <div class="form-group">
                                            <input type="number" name="phone_2" class="form-control form-control-solid mb-3 mb-lg-0" value="{{ request.user.phone_number }}", placeholder="Contact No.">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-check form-check mt-5"><label class="form-check-label"><input id="exampleRadios1" name="save_address_check" type="checkbox" class="form-check-input checkbox-group" value="add_to_list"><span class="form-check-sign"></span>Save to My Saved Addresses</label></div>
                                <div class="form-check form-check mt-3"><label class="form-check-label"><input id="exampleRadios1" name="save_address_check" type="checkbox" class="form-check-input checkbox-group" value="add_as_default"><span class="form-check-sign"></span>Save as A Default Address</label></div>
                            </div>
                        </div>

                        <div class="card mt-5"> 
                            <div class="card-header">
                                <h5 class="card-title">
                                    Ship To
                                    <span class="ms-1" data-bs-toggle="tooltip" aria-label="The Shipping/To Address" data-bs-original-title="The Shipping/To Address">
                                        <i class="ki-outline ki-information-5 text-gray-500 fs-6"></i>
                                    </span>
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 pr-md-1">
                                        <label>First Name</label>
                                        <div class="form-group">
                                            <input type="text" name="firstname" class="form-control form-control-solid mb-3 mb-lg-0"  placeholder="First Name" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 pl-md-1">
                                        <label>Last Name</label>
                                        <div class="form-group">
                                            <input type="text" name="lastname" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Last Name">
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-6 pr-md-1">
                                        <label>Address Line 1*</label>
                                        <div class="form-group">
                                            <input type="text" name="address" class="form-control form-control-solid mb-3 mb-lg-0" value="{{ request.user.address_line_1 }}", placeholder="Address 1" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 pr-md-1">
                                        <label>Address Line 2</label>
                                        <div class="form-group">
                                            <input type="text" name="address2" class="form-control form-control-solid mb-3 mb-lg-0" value="{{ request.user.address_line_2 }}", placeholder="Address 2">
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-3 pr-md-1">
                                        <label>City*</label>
                                        <div class="form-group">
                                            <input type="text" name="city" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="City" required>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <div class="form-group">
                                            <label>State*</label>
                                            <select class="form-select form-select-solid" name="abbreviation" data-control="select2" data-placeholder="Select an Option">
                                                <option selected>Select an Option</option>
                                                <option value="AL">Alabama</option>
                                                <option value="AK">Alaska</option>
                                                <option value="AZ">Arizona</option>
                                                <option value="AR">Arkansas</option>
                                                <option value="CA">California</option>
                                                <option value="CO">Colorado</option>
                                                <option value="CT">Connecticut</option>
                                                <option value="DE">Delaware</option>
                                                <option value="FL">Florida</option>
                                                <option value="GA">Georgia</option>
                                                <option value="HI">Hawaii</option>
                                                <option value="ID">Idaho</option>
                                                <option value="IL">Illinois</option>
                                                <option value="IN">Indiana</option>
                                                <option value="IA">Iowa</option>
                                                <option value="KS">Kansas</option>
                                                <option value="KY">Kentucky</option>
                                                <option value="LA">Louisiana</option>
                                                <option value="ME">Maine</option>
                                                <option value="MD">Maryland</option>
                                                <option value="MA">Massachusetts</option>
                                                <option value="MI">Michigan</option>
                                                <option value="MN">Minnesota</option>
                                                <option value="MS">Mississippi</option>
                                                <option value="MO">Missouri</option>
                                                <option value="MT">Montana</option>
                                                <option value="NE">Nebraska</option>
                                                <option value="NV">Nevada</option>
                                                <option value="NH">New Hampshire</option>
                                                <option value="NJ">New Jersey</option>
                                                <option value="NM">New Mexico</option>
                                                <option value="NY">New York</option>
                                                <option value="NC">North Carolina</option>
                                                <option value="ND">North Dakota</option>
                                                <option value="OH">Ohio</option>
                                                <option value="OK">Oklahoma</option>
                                                <option value="OR">Oregon</option>
                                                <option value="PA">Pennsylvania</option>
                                                <option value="RI">Rhode Island</option>
                                                <option value="SC">South Carolina</option>
                                                <option value="SD">South Dakota</option>
                                                <option value="TN">Tennessee</option>
                                                <option value="TX">Texas</option>
                                                <option value="UT">Utah</option>
                                                <option value="VT">Vermont</option>
                                                <option value="VA">Virginia</option>
                                                <option value="WA">Washington</option>
                                                <option value="WV">West Virginia</option>
                                                <option value="WI">Wisconsin</option>
                                                <option value="WY">Wyoming</option>
                                                <option value="DC">District of Columbia</option>
                                                <option value="MH">Marshall Islands</option>
                                                <option value="PR">PUERTO RICO</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <label>Zip Code*</label>
                                        <div class="form-group">
                                            <input type="text" name="zip_code" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Postal Code" required>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <label>Contact No. </label>
                                        <div class="form-group">
                                            <input type="number" name="phone" class="form-control form-control-solid mb-3 mb-lg-0" value="{{ request.user.phone_number }}", placeholder="Contact No. ">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-5 mb-5">
                            <div class="card-header mt-3">
                                <h5 class="card-title">Package Details</h5>
                                <div class="d-flex flex-stack">
                                    <!--begin::Label-->
                                    <div class="me-5">
                                        <!--begin::Label-->
                                        <label class="fs-5 fw-semibold">An Existing Package</label>
                                        <!--end::Label-->
                                    </div>
                                    <!--end::Label-->
                                    <!--begin::Switch-->
                                    <label class="form-check form-switch form-check-custom form-check-solid">
                                        <!--begin::Label-->
                                        <span class="form-check-label fw-semibold text-muted" style="margin-right: .5rem;">No</span>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <input id="custom_package" class="form-check-input" type="checkbox" />
                                        <!--end::Input-->
                                        <!--begin::Label-->
                                        <span class="form-check-label fw-semibold text-muted">Yes</span>
                                        <!--end::Label-->
                                    </label>
                                    <!--end::Switch-->
                                </div>

                            </div>
                            <div class="card-body">
                                <select class="form-select form-select-solid text-dark package_option mt-5" name="package" title="Select Package">
                                    <option></option>
                                    {% for key, package in packages.items %}
                                        <option 
                                            data-kt-rich-content-subcontent="<b>{{ package.0 }}</b> {{ package.6 }} <br>{{ package.1 }}x{{ package.2 }}x{{ package.3 }}in - {{ package.4 }} lbs {{ package.5 }} oz"
                                            data-item-id="{{ package.6 }}" data-package-name="{{ package.0 }}" data-length="{{ package.1 }}"
                                            data-width="{{ package.2 }}" data-height="{{ package.3 }}"
                                            data-pounds="{{ package.4 }}" data-ounces="{{ package.5 }}"
                                            value="{{ key }}"
                                        ></option>
                                    {% endfor %}
                                </select>
                                <div class="form-check form-check-custom form-check-solid mt-5" id="edit_package" style="display:none">
                                    <input class="form-check-input" id="edit_package_check" type="checkbox" value="1" id="flexCheckDefault"/>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        Edit selected package
                                    </label>
                                </div>
                            </div>

                            <div class="card-body" id="custom_packages_fields">
                                <div class="row">
                                    <div class="col-md-6 pr-md-1">
                                        <label>Item Name</label>
                                        <div class="form-group">
                                            <input type="text" name="package_name" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Item Name (Optional)">
                                        </div>
                                    </div>                                            
                                    <div class="col-md-6 pr-md-1">
                                        <label>Item ID (SKU)</label>
                                        <span class="ms-1" data-bs-toggle="tooltip" aria-label="The SKU will be printed on the shipping label." data-bs-original-title="The SKU will be printed on the shipping label.">
                                            <i class="ki-outline ki-information-5 text-gray-500 fs-6"></i>
                                        </span>
                                        <div class="form-group">
                                            <input type="text" name="item_id" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="SKU (Optional)">
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-5">
                                    <div class="col-md-6 pr-md-1">
                                        <label>Box Dimentions (Inches)*</label>
                                        <div class="row">
                                            <div class="col-md-3 pr-md-1">
                                                <div class="form-group">
                                                    <input type="number" name="LengthIN" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Length" required>
                                                </div>
                                            </div>
                                            <div class="col-md-1 pr-md-1 mt-5">
                                                X
                                            </div>
                                            <div class="col-md-3 pr-md-1">
                                                <div class="form-group">
                                                    <input type="number" name="WidthIN" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Width" required>
                                                </div>
                                            </div>
                                            <div class="col-md-1 pr-md-1 mt-5">
                                                X
                                            </div>
                                            <div class="col-md-3 pr-md-1">
                                                <div class="form-group">
                                                    <input type="number" name="HightIN" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Height" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <label>Weight (lbs)</label>
                                        <div class="form-group">
                                            <input type="number" name="weight" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Pounds">
                                        </div>
                                    </div>
                                    <div class="col-md-3 pr-md-1">
                                        <label>Weight (oz)</label>
                                        <div class="form-group">
                                            <input type="number" name="OuncesIN" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Ounces">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-check form-check-custom form-check-solid mt-5">
                                    <input class="form-check-input" name="save_package_check" id="edit_package_check" type="checkbox" value="1" id="flexCheckDefault"/>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        Save to my package list
                                    </label>
                                </div>


                            </div>
                            <!--begin::Accordion-->
                            <div class="card-body accordion accordion-icon-collapse" id="kt_accordion_3">
                                <!--begin::Item-->
                                <div class="mb-5">
                                    <!--begin::Header-->
                                    <div class="accordion-header py-3 d-flex collapsed" data-bs-toggle="collapse" data-bs-target="#kt_accordion_3_item_1">
                                        <span class="accordion-icon">
                                            <i class="ki-duotone ki-plus-square fs-3 accordion-icon-off"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>
                                            <i class="ki-duotone ki-minus-square fs-3 accordion-icon-on"><span class="path1"></span><span class="path2"></span></i>
                                        </span>
                                        <h3 class="fs-4 fw-semibold mb-0 ms-4">Add Order No.</h3>
                                        <span class="ms-1" data-bs-toggle="tooltip" aria-label="This will be included in the CSV file you receive, alongside each tracking number" data-bs-original-title="This will be included in the CSV file you receive, alongside each tracking number">
                                            <i class="ki-outline ki-information-5 text-gray-500 fs-6"></i>
                                        </span>
                                    </div>
                                    <!--end::Header-->

                                    <!--begin::Body-->
                                    <div id="kt_accordion_3_item_1" class="fs-6 collapse ps-10" data-bs-parent="#kt_accordion_3">
                                        <div class="form-group">
                                            <label for="orderNumberInput">Order Number</label>
                                            <input name="order_number" type="text" value="" class="form-control form-control-solid mb-3 mb-lg-0" id="orderNumberInput">
                                        </div>
                                    </div>
                                    <!--end::Body-->
                                </div>
                                <!--end::Item-->
                            </div>
                            <!--end::Accordion-->

                        </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="continueModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/single-label/" method="post" id="continue-form">
                {% csrf_token %}
                <div class="modal-body">
                    <p>Select shipping service*</p>
                    <!--begin::Radio group-->
                    <div data-kt-buttons="true" class="services">
                        {% for i in all_services %}
                            <!--begin::Radio button-->
                            <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex flex-stack text-start p-6 mb-5 active">
                                <!--end::Description-->
                                <div class="d-flex align-items-center me-2">
                                    <!--begin::Radio-->
                                    <div class="form-check form-check-custom form-check-solid form-check-primary me-6">
                                    </div>
                                    <!--end::Radio-->

                                    <!--begin::Info-->
                                    <div class="flex-grow-1">
                                        <h2 class="d-flex align-items-center fs-3 fw-bold flex-wrap">
                                            {{ i }}
                                            <span class="badge badge-light-success ms-2 fs-7">{% if i == "Ground Advantage" %} up to 15.99OZ {% endif %}</span>
                                        </h2>
                                        <div class="fw-semibold opacity-50">
                                            Best for 105 team size 
                                        </div>
                                    </div>
                                    <!--end::Info-->
                                </div>
                                <!--end::Description-->

                                <!--begin::Price-->
                                <div class="ms-5">
                                    <span class="mb-2">$</span>
                                    <span class="fs-2x fw-bold">
                                        139
                                    </span>
                                </div>
                                <!--end::Price-->
                            </label>
                            <!--end::Radio button-->
                        {% endfor %}
                        
                    </div>
                    <input class="form-check-input" name="service" value="" hidden/>
                    <input type="text" name="rate" hidden>
                    <p>Select label sizes*
                        <span class="ms-1" data-bs-toggle="tooltip" aria-label="Choose your label printing format" data-bs-original-title="Choose your label printing format">
                            <i class="ki-outline ki-information-5 text-gray-500 fs-6"></i>
                        </span>
                    </p>
                    <ul class="row nav nav-pills nav-pills-info nav-pills-icons justify-content-center sizes">
                    </ul>
                    <input class="form-check-input" name="size" value="" hidden/>
                    <div class="form-check form-check-custom form-check-solid mt-5">
                        <input class="form-check-input" name="terms" type="checkbox" value="0" id="flexCheckDefault" required/>
                        <label class="form-check-label" for="flexCheckDefault">
                            Iâ€™ve read and accept the <a href="{% url 'djapp:tc' %}">terms & conditions</a>
                        </label>
                    </div>
                    <input type="text" name="save_address" hidden>
                    <input type="text" name="save_package" hidden>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light me-3" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" id="continue" class="btn btn-primary">
                        <span class="indicator-label">
                            Purchase
                            <i class="las la-wallet text-white fs-3"></i>
                        </span>
                        <span class="indicator-progress">Please wait...
                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                </div>
            </form>
            <br>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<script>

    var newPackageData;
    var newAddressData;
    var singleData;

    window.addEventListener('pageshow', function(event) {
        var historyTraversal = event.persisted || 
                              (typeof window.performance != 'undefined' && 
                               window.performance.navigation.type === 2);
        if (historyTraversal) {
          // Force reload
          window.location.reload();
        }
    });


    function set_address_fields() {
        let address = $('select.address_option').children('option:selected')
        $('input[name="firstname_2"]').val(address.attr('data-firstname'))
        $('input[name="lastname_2"]').val(address.attr('data-lastname'))
        $('input[name="address_2"]').val(address.attr('data-address-one'))
        $('input[name="address2_2"]').val(address.attr('data-address-two'))
        $('input[name="city_2"]').val(address.attr('data-city'))
        $('select[name="abbreviation_2"]').val(address.attr('data-state')).trigger('change');
        $('input[name="zip_code_2"]').val(address.attr('data-zip'))
        $('input[name="phone_2"]').val(address.attr('data-phone'))
        $('select[name="abbreviation_2"]').next().find('.select2-selection__rendered').text($('select[name="abbreviation_2"]').val());
    }

    function set_package_fields() {
        let package = $('select.package_option').children('option:selected')

        $('#custom_packages_fields').find("input.error").removeClass("error");
        $('#custom_packages_fields').find("label.error").remove();
        $('input[name="item_id"]').val(package.attr('data-item-id'))
        $('input[name="package_name"]').val(package.attr('data-package-name'))
        $('input[name="LengthIN"]').val(package.attr('data-length'))
        $('input[name="WidthIN"]').val(package.attr('data-width'))
        $('input[name="HightIN"]').val(package.attr('data-height'))
        $('input[name="weight"]').val(package.attr('data-pounds'))
        $('input[name="OuncesIN"]').val(package.attr('data-ounces'))
    }

    set_address_fields()

    $("#continue").on("click", function () {
        btn_loader(this, true);
        $('#continue-form').submit();
    })

    $(document).ready(function () {
        $(".package_option").next('.select2').hide()
    });

    $("input[name='save_package_check']").on("click", function() {
        if ($(this).is(":checked")) {
          $("input[name='package_name']").attr("required", true)
        } else {
          $("input[name='package_name']").attr("required", false)
        }
    });

    $("#custom_address").on('change', function () {
        if (!$(this).is(":checked")) {
            $("#edit_address").hide()
            $("#custom_address_fields").show()
            $(".address_option").next('.select2').hide()
            $("#custom_address_fields select").val([]).trigger('change');
            $("#custom_address_fields :input[type!='checkbox']").val('');
        } else {
            $("#custom_address_fields").hide()
            $("#edit_address").show()
            $(".address_option").next('.select2').show()
            set_address_fields()
        }
        $("#edit_address_check").prop("checked", false);
        $("input[name='save_address_check']:checked").prop("checked", false);
    });

    $("#custom_package").on('change', function () {
        $("select[name='package']").next('label').remove()
        if (!$(this).is(":checked")) {
            $("#custom_packages_fields").show()
            $("#edit_package").hide()
            $(".package_option").next('.select2').hide()
            $("#custom_packages_fields :input[type!='checkbox']").val('');
        } else {
            $("#custom_packages_fields").hide()
            if ($(".package_option").val()) {
                $("#edit_package").show()
            }
            $(".package_option").next('.select2').show()
            set_package_fields()
        }
        $("#edit_package_check").prop("checked", false);
        $("input[name='save_package_check']:checked").prop("checked", false);
    });

    $(".address_option").on('change', function () {
        let selected_option = $(this).val();
        let address = $('select.address_option').children('option:selected')

        $('#custom_address_fields').find("input.error").removeClass("error");
        $('#custom_address_fields').find("label.error").remove();
        $('input[name="firstname_2"]').val(address.attr('data-firstname'))
        $('input[name="lastname_2"]').val(address.attr('data-lastname'))
        $('input[name="address_2"]').val(address.attr('data-address-one'))
        $('input[name="address2_2"]').val(address.attr('data-address-two'))
        $('input[name="city_2"]').val(address.attr('data-city'))
        $('select[name="abbreviation_2"]').val(address.attr('data-state')).trigger('change');
        $('input[name="zip_code_2"]').val(address.attr('data-zip'))
        $('input[name="phone_2"]').val(address.attr('data-phone'))

        $("input[name='save_address_check']:checked").prop("checked", false);
        $("#edit_address_check").prop("checked", false);
        $("#custom_address_fields").hide()
    })

    $("#edit_package_check").on('click', function () {
        if ($(this).is(":checked")) {
            $("#custom_packages_fields").show()
          } else {
            $("#custom_packages_fields").hide()
        }
        set_package_fields()
    })

    $("#edit_address_check").on('click', function () {
        if ($(this).is(":checked")) {
            $("#custom_address_fields").show()
          } else {
            $("#custom_address_fields").hide()
        }
        set_address_fields()
    })

    $(".package_option").on('change', function () {
        let selected_option = $(this).val();
        set_package_fields()

        $("#edit_package").show()
        $("input[name='save_package_check']:checked").prop("checked", false);
        $("#edit_package_check").prop("checked", false);
        $("#custom_packages_fields").hide();
    })

    $("#continue-form").submit(function (e) {
        let size = $('input[name="size"]').val();
        let services = $('input[name="service"]').val();
        let terms = $('input[name="terms"]:checked').val();
        //let confirmation = $('input[name="confirmation"]:checked').val();
        $('.required-message').remove();
        e.preventDefault();
        error = false

        if (!size) {
            $('input[name="size"]').after('<span class="required-message" style="color:red">This is required field.</span>')
            btn_loader("#continue", false);
            error=true;
        }

        if (!services) {
            $('input[name="service"]').after('<span class="required-message" style="color:red">This is required field.</span>')
            btn_loader("#continue", false);
            error=true;
        }

        if (terms != '0') {
            $('input[name="terms"]').after('<span class="required-message" style="color:red">This is required field.</span>')
            btn_loader("#continue", false);
            error=true;
        }

        //if (confirmation != '0') {
        //    $('input[name="confirmation"]').after('<span class="required-message" style="color:red">This is required field.</span>')
        //    btn_loader("#continue", false);
        //    error=true;
        //}

        if (error) {
            return
        }
        var form = $(this);
        debugger
        var formData = form.serializeArray();
        formData.push({ name: "new_package", value:JSON.stringify(newPackageData) })
        formData.push({ name: "new_address", value:JSON.stringify(newAddressData) })
        formData.push({ name: "single_data", value:singleData })
        var btn = $("#continue")
        $.ajax({
            type: "POST",
            url: "{% url 'djapp:single_label' %}",
            data: formData, // serializes the form's elements.
            success: function (data) {
                btn_loader(btn, false);
                $("#continueModal").modal("hide");
                var icon = "success"
                if (data.status=="Oops!") {
                    icon = "error";
                    data.message= data.message + ' <a href="/add-credit" style="color: blue; text-decoration: underline;">Top-up now.</a>'
                }
                Swal.fire({
                    icon: icon,
                    title: data.status,
                    html: data.message,
                    confirmButtonColor: '#1B84FF'
                }).then((result) => {
                    window.location.href="/single-label/";
                })
            },
            error: function (data) {
                debugger
                btn_loader(btn, false);
                $("#continueModal").modal("hide");
                Swal.fire({
                    icon: "error",
                    title: "Oops!",
                    text: "Something we wrong, Please Try again later.",
                    confirmButtonColor: '#1B84FF'
                }).then((result) => {
                    window.location.href="/single-label/";
                })
            }
        })

    })

    $("#submit_btn1").on('click', function (e) {
        e.preventDefault();
        $('.alert').remove();
        $("#table-list").hide();
        e.preventDefault(); // avoid to execute the actual submit of the form.

        var form = $("#mainForm");
        var url = "{% url 'djapp:process_label' %}";

        let weight = $('input[name="weight"]').val();
        let ounces = $('input[name="OuncesIN"]').val();
        
        if ($('#custom_package:checked').val()) {
            $('select[name="package"]').attr("required", true)
        } else {
            $('select[name="package"]').attr("required", false)
        }

        let weight_validation = false
        if (weight.trim() == "" && ounces.trim() == "") {
            weight_validation = true;
        } else {
            if (ounces.trim() == "") {
                $('input[name="OuncesIN"]').val("0");
            }
            if (weight.trim() == "") {
                $('input[name="weight"]').val("0");
            }
        }

        form.validate({
            rules: {
              abbreviation: {
                validate_state: true
              },
              abbreviation_2: {
                validate_state: true
              },
              zip_code: {
                validate_zip: true,
                required: true,
              },
              zip_code_2: {
                validate_zip: true,
                required: true,
              },
              phone: {
                validate_phone_number: true,
              },
              phone_2: {
                validate_phone_number: true,
              },
              item_id: {
                maxlength: 22,
              },
              weight: {
                number:true,
                max: 70,
                min:0,
              },
              OuncesIN: {
                number:true,
                max: 16,
                min:0,
              },
              LengthIN: {
                required: true,
                number:true,
                min:0
              },
              WidthIN: {
                required: true,
                number:true,
                min:0
              },
              HightIN: {
                required: true,
                number:true,
                min:0
              },

            },
            onfocusout: false,
            invalidHandler: function(form, validator) {
                var errors = validator.numberOfInvalids();
                if (errors) {
                  var focusElement = validator.errorList[0].element;
            
                  // Scroll to and focus on the first invalid element
                  $('html, body').animate({
                    scrollTop: $(focusElement).offset().top - 200
                  }, 500);
            
                  focusElement.focus();
                }
            }
        });

        if (!form.valid()) {
            if (weight_validation) {
                $('input[name="weight"]').addClass('error');
                $('input[name="weight"]').after('<label class="error">lbs or Ounces needs to be filled.</label>');
            }
            $("select[name='abbreviation'].error").next('label.error').hide()
            $("select[name='abbreviation'].error").next().next('.select2').after('<label class="error" >State Invalid</label>')
            $("select[name='abbreviation_2'].error").next('label.error').hide()
            $("select[name='abbreviation_2'].error").next().next('.select2').after('<label class="error" >State Invalid</label>')
            return;
        }

        if (weight_validation) {
            $('input[name="pounds"]').addClass('error');
            $('input[name="pounds"]').after('<label class="error">lbs or Ounces needs to be filled.</label>');
            e.preventDefault();
            return;
        }
        let btn = this
        btn_loader(btn, true);
        $("#continue-form")[0].reset();
        let save_address_check = $("input[name='save_address_check']:checked").val();
        $('input[name="save_address"]').val(save_address_check)

        let save_package_check = $('input[name="save_package_check"]:checked').val()
        $('input[name="save_package"]').val(save_package_check)


        $("#submit_btn1").attr('disabled', '');
        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(), // serializes the form's elements.
            success: function (data) {
                $("#submit_btn1").removeAttr('disabled');
                $("#table-body").children().remove();
                if (data.response!="UPLOADED SUCCESSFULLY") {
                    form.find('.alert').remove();
                    $(data.response).each(function () {
                            showErrorMsg($('.single-label-form-body'), 'danger', this);
                    })
                    $("#kt_app_root").animate({
                        scrollTop: document.body.scrollHeight,
                    }, 0);
                } else {
                    newPackageData = data.new_package;
                    newAddressData = data.new_address;
                    singleData = data.single_data;
                    let services = data.services;
                    let sizes = data.sizes;
                    $('.services').html('');
                    $('.sizes').html('');

                    for (var i=0; i < services.length; i++){
                        var exclusive = ""
                        if (services[i].name == "Ground Advantage") {
                            exclusive = "up to 15.99OZ"
                        }
                        var servicedescription = '';
                        if (services[i].name == "Ground Advantage") {
                            servicedescription = "2 - 5 working days";
                        } else if (services[i].name == "Priority Mail") {
                            servicedescription = "1 - 3 working days";
                        }
                        $('.services').append(`
                            <label class="btn btn-outline services-tab btn-outline-dashed btn-active-light-primary d-flex flex-stack text-start p-2 mb-5" style="height:90%" data-value="${services[i].name}" data-rate="${services[i].rate}">
                                <!--end::Description-->
                                <div class="d-flex align-items-center me-2">
                                    <!--begin::Radio-->
                                    <div class="form-check form-check-custom form-check-solid form-check-primary me-6">
                                        <img src="/static/images/USPS-Logo.png" width="60px" style="float: left;">
                                    </div>
                                    <!--end::Radio-->

                                    <!--begin::Info-->
                                    <div class="flex-grow-1">
                                        <h2 class="d-flex align-items-center fs-3 fw-bold flex-wrap">
                                            ${services[i].name}
                                            <span class="badge badge-light-success ms-2 fs-7">${exclusive}</span>
                                        </h2>
                                        <div class="fw-semibold opacity-50">
                                            ${servicedescription}
                                        </div>
                                    </div>
                                    <!--end::Info-->
                                </div>
                                <!--end::Description-->

                                <!--begin::Price-->
                                <div class="ms-5">
                                    <span class="fs-2x">$</span>
                                    <span class="fs-2x fw-bold">
                                        ${services[i].rate}
                                    </span>

                                </div>
                                <!--end::Price-->
                            </label>
                        `);
                    }

                    for (var i=0; i < sizes.length; i++){

                        var sizesdescription = '';
                        if (sizes[i] == "Letter A4") {
                            sizesdescription = "8.5x11 in PDF";
                        } else if (sizes[i] == "4x6in") {
                            sizesdescription = "For Thermal Printer";
                        }
                        $('.sizes').append(`
                            <div class="col-6">
                                <label class="w-100 btn btn-outline btn-outline-dashed btn-active-light-primary flex-stack text-start p-2 mb-5 sizes-tab" style="height:90%" data-size="${sizes[i]}">
                                    <!--end::Description-->
                                    <div class="align-items-center me-2">
                                        <!--begin::Radio-->
                                        <div class="form-check form-check-custom form-check-solid form-check-primary me-6">
                                        </div>
                                        <!--end::Radio-->
    
                                        <!--begin::Info-->
                                        <div class="flex-grow-1 text-center">
                                            <div class="text-center">
                                                <i class="ki-duotone ki-design-frame fs-3x">
                                                    <span class="path1"></span>
                                                    <span class="path2"></span>
                                                </i>
                                            </div>
                                            <h2>
                                                ${sizes[i]}
                                            </h2>
                                            <div class="fw-semibold opacity-50">
                                                ${sizesdescription}
                                            </div>
                                        </div>
                                        <!--end::Info-->
                                    </div>
                                    <!--end::Description-->
                                </label>
                            </div>
                        `);
                    }

                    modal = $("#continueModal").modal("show");
                    $("#continue-form").find(".required-message").remove()
                    $(".sizes-tab").on("click", function () {
                        $(".sizes-tab").removeClass("active");
                        $(this).addClass("active");
                        let size = $(this).attr('data-size');
                        $('input[name="size"]').val(size);
                    })
                
                    $(".services-tab").on("click", function () {
                        $(".services-tab").removeClass("active");
                        $(this).addClass("active");
                        let service = $(this).attr('data-value');
                        $('input[name="service"]').val(service);

                        let rate = $(this).attr('data-rate');
                        $('input[name="rate"]').val(rate);
                    })
                }
                btn_loader(btn, false);
            },
            error: function (data) {
                btn_loader(btn, false);
                showErrorMsg($('.single-label-form-body'), 'danger', "Something went wrong!");
                $("#kt_app_root").animate({
                    scrollTop: document.body.scrollHeight,
                }, 500);
            }
        })
    })

    // Format options
const optionFormat = (item) => {
    if (!item.id) {
        return item.text;
    }

    var span = document.createElement('span');
    var template = '';

    template += '<div class="d-flex align-items-center">';
    template += '<span class="fs-5">' + item.element.getAttribute('data-kt-rich-content-subcontent') + '</span>';
    template += '</div>';

    span.innerHTML = template;

    return $(span);
}

// Init Select2 --- more info: https://select2.org/
$('.address_option').select2({
    placeholder: "Select an option",
    minimumResultsForSearch: Infinity,
    templateSelection: optionFormat,
    templateResult: optionFormat
});

// Init Select2 --- more info: https://select2.org/
$('.package_option').select2({
    placeholder: "Select an option",
    minimumResultsForSearch: Infinity,
    templateSelection: optionFormat,
    templateResult: optionFormat
});

$('select[name="abbreviation"]').on('select2:close', function () {
    $(this).next("label").remove()
    $(this).next().next("label").remove()
    $(this).next().find('.select2-selection__rendered').text($(this).val());
})

$('select[name="abbreviation_2"]').on('select2:close', function () {
    $(this).next("label").remove()
    $(this).next().next("label").remove()
    $(this).next().find('.select2-selection__rendered').text($(this).val());
})

$('.checkbox-group').change(function() {
    // Uncheck all other checkboxes in the group
    $('.checkbox-group').not(this).prop('checked', false);
});

</script>
{% endblock %}